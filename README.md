# Diplodoc page-constructor extension

[![NPM version](https://img.shields.io/npm/v/@diplodoc/page-constructor-extension.svg?style=flat)](https://www.npmjs.org/package/@diplodoc/page-constructor-extension)

This is an extension of the Diplodoc platform, which allows using the Page Constructor component from Gravity UI in your documentation. It enables creating rich, interactive page layouts with various block types directly in your markdown files.

The extension contains some parts:
- [Prepared runtime](#prepared-runtime)
- [MarkdownIt transform plugin](#markdownit-transform-plugin)
- [React component for rendering](#react-component-for-rendering)

## Quickstart

Attach the plugin to the transformer:

```js
import pageConstructorExtension from '@diplodoc/page-constructor-extension';
import transform from '@diplodoc/transform';

const {result} = await transform(`
::: page-constructor
blocks:
  - type: 'header-block'
    title: 'My Header'
    description: 'This is a description'
:::
`, {
    plugins: [
        pageConstructorExtension.transform({ bundle: false })
    ]
});
```

## Prepared runtime

It is necessary to add `runtime` scripts to make page constructor interactive on your page.<br/>
You can add assets files which were generated by the [MarkdownIt transform plugin](#markdownit-transform-plugin).
```html
<html>
    <head>
        <!-- Read more about '_assets/page-constructor.js' and '_assets/page-constructor.css' in 'Transform plugin' section -->
        <script src='_assets/page-constructor.js'></script>
        <link rel='stylesheet' href='_assets/page-constructor.css' />
    </head>
    <body>
        ${result.html}
    </body>
</html>
```

Or you can just include runtime's source code in your bundle.
```js
import '@diplodoc/page-constructor-extension/runtime'
import '@diplodoc/page-constructor-extension/runtime/styles.css'
```

## MarkdownIt transform plugin

Plugin for [@diplodoc/transform](https://github.com/diplodoc-platform/transform) package.

Options:
- `runtime` - name of runtime script and style which will be exposed in results `script` and `style` sections.<br>
  Can be a string (both script and style will use the same name) or an object with separate `script` and `style` properties.<br>
  Default: `{ script: '_assets/page-constructor.js', style: '_assets/page-constructor.css' }`<br>

- `bundle` - boolean flag to enable/disable copying of bundled runtime to target directory.<br>
  Where target directory is `<transformer output option>/<plugin runtime option>`<br>
  Default: `true`<br>

- `assetLinkResolver` - function to resolve asset links (images, videos, etc.) in the page constructor content.<br>
  Signature: `(link: string) => string`<br>
  Default: `undefined`<br>

- `contentLinkResolver` - function to resolve content links (markdown files, HTML files, etc.) in the page constructor content.<br>
  Signature: `(link: string) => string`<br>
  Default: `undefined`<br>

## React component for rendering

The extension provides React components for rendering page constructor content:

```jsx
import { createPageConstructorElement } from '@diplodoc/page-constructor-extension/runtime';

// Your page constructor content
const content = {
  blocks: [
    {
      type: 'header-block',
      title: 'My Header',
      description: 'This is a description'
    }
  ]
};

// Render the page constructor
const element = createPageConstructorElement(content);
```

## Syntax

You can use the page constructor in your markdown files using the `page-constructor` directive:

```markdown
::: page-constructor
blocks:
  - type: 'header-block'
    title: 'My Header'
    description: 'This is a description'
:::
```

Or with a list format:

```markdown
::: page-constructor
- type: 'header-block'
  title: 'My Header'
  description: 'This is a description'
:::
```

## Link Resolvers

The `assetLinkResolver` and `contentLinkResolver` options allow you to customize how links are resolved in the page constructor content. These functions are called for each link in the content and should return the resolved link.

- `assetLinkResolver`: Called for links to assets (images, videos, etc.)
- `contentLinkResolver`: Called for links to content (markdown files, HTML files, etc.)

Example:

```js
pageConstructorPlugin({
  // Other options...
  assetLinkResolver: (link) => {
    // Add a prefix to asset links
    return link.startsWith('http') ? link : `/assets/${link}`;
  },
  contentLinkResolver: (link) => {
    // Convert .md links to .html
    return link.endsWith('.md') ? link.replace('.md', '.html') : link;
  }
})
```

## Example

See the `example` directory for a complete example of how to use this extension.
